import{createClient}from"https://esm.sh/@supabase/supabase-js@2";const btnDr=document.getElementById("btttn");btnDr&&(window.addEventListener("scroll",(function(){window.pageYOffset>=300?btnDr.style.display="block":btnDr.style.display="none"})),btnDr.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})})));const res=await fetch("/.netlify/functions/fcnfig");const{url,key}=await res.json();export const supabase=createClient(url,key);document.getElementById("submitable").addEventListener("submit",(async e=>{e.preventDefault();const t=document.querySelector("#signEmail").value,a=document.querySelector("#signPsw").value,r=document.querySelector("#signUserName").value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s=document.querySelector("#signBio").value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),o=document.querySelector("#signSkill").value,l=document.querySelector("#signFullName").value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=document.querySelector("#signImg");try{const{data:e,error:c}=await supabase.auth.signUp({email:t,password:a});if(c)throw c;const i=e.user;let u="https://placehold.co/100x100";if(n.files.length>0){const e=n.files[0],t=`avatars/${i.id}_${Date.now()}_${e.name}`,{error:a}=await supabase.storage.from("avatars").upload(t,e);if(a)console.error("Upload failed:",a.message);else{const{data:e}=supabase.storage.from("avatars").getPublicUrl(t);u=e.publicUrl}}const{error:d}=await supabase.from("profiles").insert([{id:i.id,username:r,full_name:l,bio:s,skills:o,email:t,photo_url:u,created_at:new Date}]);if(d)throw d;cAlert("✅ Signup successful!"),window.location.href="/dashboard"}catch(e){cAlert("❌ Error: "+e.message)}})),document.querySelector("#haveAcct form").addEventListener("submit",(async e=>{e.preventDefault();const t=document.querySelector("#logEmail").value,a=document.querySelector("#logPsw").value;try{const{error:e}=await supabase.auth.signInWithPassword({email:t,password:a});if(e)throw e;cAlert("✅ Logged in successfully!"),window.location.href="/dashboard"}catch(e){cAlert("❌ Login failed: "+e.message)}}));
